<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="assignments.ex4.model.mapper.BookMapper">
    <insert id="addBook" parameterType="assignments.ex4.model.dto.BookDto" useGeneratedKeys="true" keyProperty="id">
        insert into books(title, stock) values(#{title}, #{stock})
    </insert>

    <select id="searchRental" resultType="assignments.ex4.model.dto.RentalDto">
        select * from rentals join books on books.id = rentals.book_id
        <where>
            <if test="member != null">
                and member = #{member}
            </if>
            <if test="title != null">
                and title like concat('%',#{title},'%')
            </if>
        </where>
    </select>

    <insert id="addBooks" parameterType="list" useGeneratedKeys="true" keyProperty="id">
        insert into books(title, stock) values
        <foreach collection="list" item="book" separator=",">
            (#{book.title}, #{book.stock})
        </foreach>
    </insert>
</mapper>